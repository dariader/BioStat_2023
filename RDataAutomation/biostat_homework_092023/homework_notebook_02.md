---
title: "automatization_notebook_02"
output: word_document
date: "2023-10-15"
---



# Чтение данных

В вашем варианте нужно использовать датасет food.


```r
data <- read.csv('data/raw/food.csv')
str(data)
```

```
## 'data.frame':	7083 obs. of  38 variables:
##  $ Category                      : chr  "Milk" "Milk" "Milk" "Milk" ...
##  $ Description                   : chr  "Milk, human" "Milk, NFS" "Milk, whole" "Milk, low sodium, whole" ...
##  $ Nutrient.Data.Bank.Number     : int  11000000 11100000 11111000 11111100 11111150 11111160 11111170 11112110 11112120 11112130 ...
##  $ Data.Alpha.Carotene           : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Data.Beta.Carotene            : int  7 4 7 7 7 1 0 3 1 3 ...
##  $ Data.Beta.Cryptoxanthin       : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Data.Carbohydrate             : num  6.89 4.87 4.67 4.46 4.67 5.19 4.85 4.91 5.19 4.91 ...
##  $ Data.Cholesterol              : int  14 8 12 14 12 5 2 8 5 8 ...
##  $ Data.Choline                  : num  16 17.9 17.8 16 17.8 17.4 16 18.2 17.4 18.2 ...
##  $ Data.Fiber                    : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ Data.Lutein.and.Zeaxanthin    : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Data.Lycopene                 : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Data.Niacin                   : num  0.177 0.11 0.105 0.043 0.105 0.113 0.088 0.112 0.113 0.112 ...
##  $ Data.Protein                  : num  1.03 3.34 3.28 3.1 3.28 3.38 3.4 3.35 3.38 3.35 ...
##  $ Data.Retinol                  : int  60 58 31 28 31 58 137 83 58 83 ...
##  $ Data.Riboflavin               : num  0.036 0.137 0.138 0.105 0.138 0.14 0.14 0.137 0.14 0.137 ...
##  $ Data.Selenium                 : num  1.8 1.9 1.9 2 1.9 2.1 2.1 1.8 2.1 1.8 ...
##  $ Data.Sugar.Total              : num  6.89 4.89 4.81 4.46 4.81 4.96 4.85 4.89 4.96 4.89 ...
##  $ Data.Thiamin                  : num  0.014 0.057 0.056 0.02 0.056 0.057 0.036 0.059 0.057 0.059 ...
##  $ Data.Water                    : num  87.5 89 88.1 88.2 88.1 ...
##  $ Data.Fat.Monosaturated.Fat    : num  1.658 0.426 0.688 0.999 0.688 ...
##  $ Data.Fat.Polysaturated.Fat    : num  0.497 0.065 0.108 0.128 0.108 0.032 0.007 0.058 0.032 0.058 ...
##  $ Data.Fat.Saturated.Fat        : num  2.01 1.16 1.86 2.15 1.86 ...
##  $ Data.Fat.Total.Lipid          : num  4.38 1.99 3.2 3.46 3.2 0.95 0.18 1.9 0.95 1.9 ...
##  $ Data.Major.Minerals.Calcium   : int  32 126 123 101 123 126 204 126 126 126 ...
##  $ Data.Major.Minerals.Copper    : num  0.052 0.001 0.001 0.01 0.001 0.001 0.011 0.001 0.001 0.001 ...
##  $ Data.Major.Minerals.Iron      : num  0.03 0 0 0.05 0 0 0.04 0 0 0 ...
##  $ Data.Major.Minerals.Magnesium : int  3 12 12 5 12 12 11 12 12 12 ...
##  $ Data.Major.Minerals.Phosphorus: int  14 103 101 86 101 103 101 103 103 103 ...
##  $ Data.Major.Minerals.Potassium : int  51 157 150 253 150 159 166 159 159 159 ...
##  $ Data.Major.Minerals.Sodium    : int  17 39 38 3 38 39 52 39 39 39 ...
##  $ Data.Major.Minerals.Zinc      : num  0.17 0.42 0.41 0.38 0.41 0.43 0.4 0.43 0.43 0.43 ...
##  $ Data.Vitamins.Vitamin.A...RAE : int  61 59 32 29 32 58 137 83 58 83 ...
##  $ Data.Vitamins.Vitamin.B12     : num  0.05 0.56 0.54 0.36 0.54 0.61 0.38 0.55 0.61 0.55 ...
##  $ Data.Vitamins.Vitamin.B6      : num  0.011 0.06 0.061 0.034 0.061 0.06 0.04 0.061 0.06 0.061 ...
##  $ Data.Vitamins.Vitamin.C       : num  5 0.1 0 0.9 0 0 1 0.2 0 0.2 ...
##  $ Data.Vitamins.Vitamin.E       : num  0.08 0.03 0.05 0.08 0.05 0.02 0.01 0.03 0.02 0.03 ...
##  $ Data.Vitamins.Vitamin.K       : num  0.3 0.2 0.3 0.3 0.3 0.1 0 0.2 0.1 0.2 ...
```

# Выведите общее описание данных


```r
library(dplyr)
library(Hmisc)
data %>% describe()
```

```
## . 
## 
##  38  Variables      7083  Observations
## ---------------------------------------------------------------------------------------
## Category 
##        n  missing distinct 
##     7083        0     2429 
## 
## lowest : 100 GRAND Bar                  3 MUSKETEERS Bar               3 Musketeers Truffle Crisp Bar Abalone                        Adobo                         
## highest: Zombie                         Zucchini                       Zucchini lasagna               Zucchini soup                  Zwieback toast                
## ---------------------------------------------------------------------------------------
## Description 
##        n  missing distinct 
##     7083        0     7083 
## 
## lowest : 100 GRAND Bar                               3 MUSKETEERS Bar                            3 Musketeers Truffle Crisp Bar              Abalone, cooked, NS as to cooking method    Abalone, floured or breaded, fried         
## highest: Zombie                                      Zucchini lasagna, diet frozen meal          Zucchini soup, cream of, prepared with milk Zucchini, pickled                           Zwieback toast                             
## ---------------------------------------------------------------------------------------
## Nutrient.Data.Bank.Number 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     7083        1 48849646 27511121 11740312 21602028 27150770 
##      .50      .75      .90      .95 
## 53260200 67203450 83112400 92161002 
## 
## lowest : 11000000 11100000 11111000 11111100 11111150
## highest: 99997802 99997804 99997810 99998130 99998210
## ---------------------------------------------------------------------------------------
## Data.Alpha.Carotene 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      362    0.609    43.76    83.83      0.0      0.0      0.0 
##      .50      .75      .90      .95 
##      0.0      1.0     24.0    191.9 
## 
## lowest :    0    1    2    3    4, highest: 3716 3971 4016 4342 4655
## ---------------------------------------------------------------------------------------
## Data.Beta.Carotene 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      871    0.966    255.4    462.3        0        0        0 
##      .50      .75      .90      .95 
##        8       73      420     1152 
## 
## lowest :     0     1     2     3     4, highest: 10920 10927 10948 11463 14134
## ---------------------------------------------------------------------------------------
## Data.Beta.Cryptoxanthin 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      121    0.645    4.862    9.069        0        0        0 
##      .50      .75      .90      .95 
##        0        1        8       18 
## 
## lowest :    0    1    2    3    4, highest:  503  589  782 1447 1922
## ---------------------------------------------------------------------------------------
## Data.Carbohydrate 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     3113        1    20.83    22.29     0.00     0.72     5.65 
##      .50      .75      .90      .95 
##    13.30    26.20    56.70    71.51 
## 
## lowest : 0     0.01  0.03  0.04  0.05 , highest: 99.1  99.35 99.6  99.77 100  
## ---------------------------------------------------------------------------------------
## Data.Cholesterol 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      274    0.959    34.46    50.29        0        0        0 
##      .50      .75      .90      .95 
##        8       46       91      126 
## 
## lowest :    0    1    2    3    4, highest: 1064 1082 1085 1691 3074
## ---------------------------------------------------------------------------------------
## Data.Choline 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     1108        1    34.44    37.26     0.80     3.60    10.00 
##      .50      .75      .90      .95 
##    19.60    44.20    80.68   101.29 
## 
## lowest : 0     0.1   0.2   0.3   0.4  , highest: 490.9 508.9 612   654.2 820.2
## ---------------------------------------------------------------------------------------
## Data.Fiber 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      160    0.987    1.704     2.11      0.0      0.0      0.1 
##      .50      .75      .90      .95 
##      1.0      2.1      4.0      6.3 
## 
## lowest : 0    0.1  0.2  0.3  0.4 , highest: 29.3 37   37.5 42.8 46.2
## ---------------------------------------------------------------------------------------
## Data.Lutein.and.Zeaxanthin 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      735    0.969    213.4    379.9      0.0      0.0      0.0 
##      .50      .75      .90      .95 
##     18.0     81.0    324.0    729.3 
## 
## lowest :     0     1     2     3     4, highest: 13592 13610 13633 15189 15643
## ---------------------------------------------------------------------------------------
## Data.Lycopene 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      677    0.382    263.6    496.4        0        0        0 
##      .50      .75      .90      .95 
##        0        0      361     1718 
## 
## lowest :     0     1     2     3     4, highest: 12665 12700 12819 13895 45902
## ---------------------------------------------------------------------------------------
## Data.Niacin 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     3317        1    2.647    3.101   0.0522   0.1230   0.5350 
##      .50      .75      .90      .95 
##   1.4870   3.4000   5.9660   8.3330 
## 
## lowest : 0      0.001  0.002  0.003  0.004 , highest: 40     40.2   54.848 69     127.5 
## ---------------------------------------------------------------------------------------
## Data.Protein 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     2107        1    8.599     8.62    0.170    0.762    2.220 
##      .50      .75      .90      .95 
##    6.190   12.130   21.008   25.089 
## 
## lowest : 0     0.01  0.02  0.03  0.04 , highest: 62.82 64.06 66.67 76.25 78.13
## ---------------------------------------------------------------------------------------
## Data.Retinol 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      374    0.947    49.83    82.01        0        0        0 
##      .50      .75      .90      .95 
##        8       43       92      170 
## 
## lowest :    0    1    2    3    4, highest: 4220 4716 6233 7664 9349
## ---------------------------------------------------------------------------------------
## Data.Riboflavin 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      634        1   0.1888   0.1992   0.0110   0.0230   0.0600 
##      .50      .75      .90      .95 
##   0.1240   0.2200   0.3340   0.4489 
## 
## lowest : 0     0.001 0.002 0.003 0.004, highest: 3.56  3.8   4     5.86  17.5 
## ---------------------------------------------------------------------------------------
## Data.Selenium 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      539        1    13.09       15      0.1      0.4      1.7 
##      .50      .75      .90      .95 
##      8.1     20.0     29.9     37.6 
## 
## lowest : 0     0.1   0.2   0.3   0.4  , highest: 166.6 169.5 169.8 283.1 1917 
## ---------------------------------------------------------------------------------------
## Data.Sugar.Total 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     1788    0.999    7.337    10.29     0.00     0.04     0.78 
##      .50      .75      .90      .95 
##     2.39     7.38    21.40    35.10 
## 
## lowest : 0     0.01  0.02  0.03  0.04 , highest: 97.02 97.15 97.81 99.22 99.8 
## ---------------------------------------------------------------------------------------
## Data.Thiamin 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      666        1   0.1714   0.2054    0.005    0.014    0.040 
##      .50      .75      .90      .95 
##    0.087    0.189    0.362    0.533 
## 
## lowest : 0      0.001  0.002  0.003  0.004 , highest: 4.4    5.17   8.06   10.99  23.375
## ---------------------------------------------------------------------------------------
## Data.Water 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     3884        1     59.8    29.56     2.90     8.75    45.89 
##      .50      .75      .90      .95 
##    66.59    80.60    88.46    91.62 
## 
## lowest : 0     0.02  0.03  0.11  0.12 , highest: 99.88 99.89 99.9  99.93 99.98
## ---------------------------------------------------------------------------------------
## Data.Fat.Monosaturated.Fat 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     3623        1    3.218    3.814   0.0011   0.0200   0.5130 
##      .50      .75      .90      .95 
##   1.8690   4.4330   7.4642   9.8610 
## 
## lowest : 0      0.001  0.002  0.003  0.004 , highest: 59.275 63.276 69.9   72.961 75.221
## ---------------------------------------------------------------------------------------
## Data.Fat.Polysaturated.Fat 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     3072        1    2.174    2.761   0.0050   0.0462   0.3380 
##      .50      .75      .90      .95 
##   1.0360   2.6250   4.9202   7.4484 
## 
## lowest : 0      0.001  0.002  0.003  0.004 , highest: 57.74  61.7   63.3   65.7   67.849
## ---------------------------------------------------------------------------------------
## Data.Fat.Saturated.Fat 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     3474        1    2.795    3.362    0.002    0.037    0.503 
##      .50      .75      .90      .95 
##    1.444    3.668    6.550    9.453 
## 
## lowest : 0      0.001  0.002  0.003  0.004 , highest: 46.235 46.24  51.368 61.924 82.5  
## ---------------------------------------------------------------------------------------
## Data.Fat.Total.Lipid 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     2100        1    8.958    9.959     0.08     0.22     2.06 
##      .50      .75      .90      .95 
##     5.48    12.65    19.89    27.59 
## 
## lowest : 0     0.01  0.02  0.03  0.04 , highest: 99.1  99.48 99.97 99.98 100  
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Calcium 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      407        1    73.47       88        3        7       14 
##      .50      .75      .90      .95 
##       37       92      163      238 
## 
## lowest :    0    1    2    3    4, highest: 1160 1200 1245 1257 1375
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Copper 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      595        1   0.1416   0.1611   0.0100   0.0210   0.0500 
##      .50      .75      .90      .95 
##   0.0790   0.1280   0.2310   0.3707 
## 
## lowest : 0      0.001  0.002  0.003  0.004 , highest: 7.154  8.916  9.301  14.164 14.466
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Iron 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      621        1    1.752    2.046    0.040    0.160    0.460 
##      .50      .75      .90      .95 
##    1.040    1.840    2.950    4.269 
## 
## lowest : 0     0.01  0.02  0.03  0.04 , highest: 47.6  48.21 53.01 62.1  64.1 
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Magnesium 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      219    0.999    27.79    26.32        3        6       12 
##      .50      .75      .90      .95 
##       20       29       49       79 
## 
## lowest :   0   1   2   3   4, highest: 499 500 543 550 611
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Phosphorus 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      517        1    133.1    121.8        7       17       48 
##      .50      .75      .90      .95 
##      102      189      267      337 
## 
## lowest :    0    1    2    3    4, highest: 1174 1239 1272 1321 1429
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Potassium 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      670        1    217.1    166.1     27.1     65.0    111.0 
##      .50      .75      .90      .95 
##    183.0    270.5    381.0    474.9 
## 
## lowest :    0    1    2    3    4, highest: 2443 3427 3501 3535 6040
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Sodium 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0     1028        1    340.5    308.3        4       16      124 
##      .50      .75      .90      .95 
##      313      454      663      816 
## 
## lowest :    0    1    2    3    4, highest: 4950 5493 5843 7027 7851
## ---------------------------------------------------------------------------------------
## Data.Major.Minerals.Zinc 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      559        1    1.281     1.51    0.040    0.110    0.360 
##      .50      .75      .90      .95 
##    0.680    1.360    2.540    3.769 
## 
## lowest : 0     0.01  0.02  0.03  0.04 , highest: 51.7  63.32 66.7  78.26 98.86
## ---------------------------------------------------------------------------------------
## Data.Vitamins.Vitamin.A...RAE 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      496    0.992    73.14    111.7        0        0        2 
##      .50      .75      .90      .95 
##       20       61      160      296 
## 
## lowest :    0    1    2    3    4, highest: 4220 4727 6255 7679 9363
## ---------------------------------------------------------------------------------------
## Data.Vitamins.Vitamin.B12 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      453    0.966   0.7052    1.117    0.000    0.000    0.000 
##      .50      .75      .90      .95 
##    0.180    0.550    1.600    2.629 
## 
## lowest : 0     0.01  0.02  0.03  0.04 , highest: 45.89 50.67 69.99 72.03 82.44
## ---------------------------------------------------------------------------------------
## Data.Vitamins.Vitamin.B6 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      712        1   0.1975   0.2303    0.005    0.022    0.052 
##      .50      .75      .90      .95 
##    0.110    0.203    0.386    0.584 
## 
## lowest : 0     0.001 0.002 0.003 0.004, highest: 5.899 6.05  6.44  6.9   12   
## ---------------------------------------------------------------------------------------
## Data.Vitamins.Vitamin.C 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      453    0.963    5.696    9.131     0.00     0.00     0.00 
##      .50      .75      .90      .95 
##     0.70     5.30    14.98    26.30 
## 
## lowest : 0     0.1   0.2   0.3   0.4  , highest: 228.3 230.8 250   260.8 560  
## ---------------------------------------------------------------------------------------
## Data.Vitamins.Vitamin.E 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      511        1    1.087    1.376     0.00     0.04     0.23 
##      .50      .75      .90      .95 
##     0.55     1.11     1.93     2.87 
## 
## lowest : 0     0.01  0.02  0.03  0.04 , highest: 43.2  46.35 51.92 60.97 149.4
## ---------------------------------------------------------------------------------------
## Data.Vitamins.Vitamin.K 
##        n  missing distinct     Info     Mean      Gmd      .05      .10      .25 
##     7083        0      630    0.999    14.21    22.57      0.0      0.0      0.8 
##      .50      .75      .90      .95 
##      3.8      9.3     22.5     43.0 
## 
## lowest : 0     0.1   0.2   0.3   0.4  , highest: 778.4 812.8 830   866.5 1640 
## ---------------------------------------------------------------------------------------
```

# Очистка данных

1) Уберите переменные, в которых пропущенных значений больше 20% или уберите субъектов со слишком большим количеством пропущенных значений. Или совместите оба варианта. Напишите обоснование, почему вы выбрали тот или иной вариант:

**Обоснование**: 

2) Переименуйте переменные в человекочитаемый вид (что делать с пробелами в названиях?);

3) В соответствии с описанием данных приведите переменные к нужному типу (numeric или factor);

4) Отсортируйте данные по возрасту по убыванию;

5) Сохраните в файл outliers.csv субъектов, которые являются выбросами (например, по правилу трёх сигм) — это необязательное задание со звёздочкой;

6) Отфильтруйте датасет так, чтобы остались только Rice и Cookie (переменная Category и есть группирующая);

7) Присвойте получившийся датасет переменной "cleaned_data".

```r
na_count <- sum(is.na(data)) # 0 выглядит так, что некоторые значения означают отстутсиве данных, но в NA не конвертируются.
colnames(data) <- gsub("[^A-Za-z0-9_]", "_", colnames(data))
data$Category <- as.factor(data$Category)
data$Nutrient_Data_Bank_Number <- as.factor(data$Nutrient_Data_Bank_Number)
data <- data %>% arrange(desc(Data_Carbohydrate))

q1 <- quantile(data$Data_Carbohydrate, 0.135)
q3 <- quantile(data$Data_Carbohydrate, 1 - 0.135)
iqr <- q3 - q1

outliers <- data[data$Data_Carbohydrate < q1 - 1.5 * iqr | data$Data_Carbohydrate > q3 + 1.5 * iqr,]
write.csv(outliers, file = '../../outliers.csv') # empty, too big IQR

data = data %>% filter(Category %in% c("Rice", "Cookie"))
cleaned_data = data
```

# Сколько осталось переменных?


```r
# поскольку пустые значения обнаружены не были, переменных осталось столько же сколько и было
ncol(cleaned_data)
```

```
## [1] 38
```

# Сколько осталось случаев?


```r
nrow(cleaned_data)
```

```
## [1] 243
```

# Есть ли в данных идентичные строки?


```r
sum(duplicated(cleaned_data))# дуплицированных строк нет
```

```
## [1] 0
```

```r
nrow(cleaned_data %>% distinct())# дуплицированных строк нет
```

```
## [1] 243
```

# Сколько всего переменных с пропущенными значениями в данных и сколько пропущенных точек в каждой такой переменной?


```r
# пропущенных значений нет
```

# Описательные статистики

## Количественные переменные

1) Рассчитайте для всех количественных переменных для каждой группы (Category):

1.1) Количество значений;

1.2) Количество пропущенных значений;

1.3) Среднее;

1.4) Медиану;

1.5) Стандартное отклонение;

1.6) 25% квантиль и 75% квантиль;

1.7) Интерквартильный размах;

1.8) Минимум;

1.9) Максимум;

1.10) 95% ДИ для среднего - задание со звёздочкой.


```r
numeric_columns <- sapply(cleaned_data, is.numeric)
calculate_stats <- function(column) {
  count <- length(column)
  missing <- sum(is.na(column))
  mean_val <- mean(column)
  median_val <- median(column)
  sd_val <- sd(column)
  q25 <- quantile(column, 0.25)
  q75 <- quantile(column, 0.75)
  iqr_val <- IQR(column)
  min_val <- min(column)
  max_val <- max(column)
  ci95 <- mean_val + c(-1, 1) * qt(0.975, count - 1) * (sd_val / sqrt(count))

  return(c(Count = count, Missing = missing, Mean = mean_val, Median = median_val, SD = sd_val, Q25 = q25, Q75 = q75, IQR = iqr_val, Min = min_val, Max = max_val, CI95 = ci95))
}

result <- by(cleaned_data[numeric_columns], cleaned_data$Category, FUN = function(df) {
  result <- mapply(calculate_stats, df)
  colnames(result) <- colnames(df)
  return(result)
})

result_df <- do.call(rbind, result)

print(result_df)
```

```
##         Data_Alpha_Carotene Data_Beta_Carotene Data_Beta_Cryptoxanthin
## Count            100.000000         100.000000            100.00000000
## Missing            0.000000           0.000000              0.00000000
## Mean               8.250000          17.430000              0.38000000
## Median             0.000000           0.000000              0.00000000
## SD                80.992003         102.624771              1.98367071
## Q25.25%            0.000000           0.000000              0.00000000
## Q75.75%            0.000000           1.000000              0.00000000
## IQR                0.000000           1.000000              0.00000000
## Min                0.000000           0.000000              0.00000000
## Max              810.000000        1002.000000             18.00000000
## CI951             -7.820571          -2.932981             -0.01360331
## CI952             24.320571          37.792981              0.77360331
## Count            143.000000         143.000000            143.00000000
## Missing            0.000000           0.000000              0.00000000
## Mean             125.055944         310.923077              1.25174825
## Median             4.000000          74.000000              0.00000000
## SD               211.156666         469.487285              5.78544620
## Q25.25%            0.000000           6.000000              0.00000000
## Q75.75%          193.000000         415.000000              0.00000000
## IQR              193.000000         409.000000              0.00000000
## Min                0.000000           0.000000              0.00000000
## Max              926.000000        2044.000000             31.00000000
## CI951             90.149796         233.312491              0.29536054
## CI952            159.962092         388.533663              2.20813597
##         Data_Carbohydrate Data_Cholesterol Data_Choline  Data_Fiber
## Count          100.000000       100.000000   100.000000 100.0000000
## Missing          0.000000         0.000000     0.000000   0.0000000
## Mean            68.087300         8.680000    13.276000   2.6730000
## Median          67.785000         0.000000    11.050000   2.1000000
## SD               6.950964        26.916211    12.358722   2.4955660
## Q25.25%         63.870000         0.000000     6.700000   1.4750000
## Q75.75%         72.225000         2.000000    14.600000   3.0000000
## IQR              8.355000         2.000000     7.900000   1.5250000
## Min             50.520000         0.000000     0.000000   0.0000000
## Max             84.000000       221.000000    92.000000  16.1000000
## CI951           66.708078         3.339240    10.823761   2.1778256
## CI952           69.466522        14.020760    15.728239   3.1681744
## Count          143.000000       143.000000   143.000000 143.0000000
## Missing          0.000000         0.000000     0.000000   0.0000000
## Mean            21.947972         2.510490     7.625175   1.2398601
## Median          21.360000         0.000000     7.600000   1.1000000
## SD               3.213487         6.645836     4.216174   0.6971915
## Q25.25%         19.820000         0.000000     3.800000   0.9000000
## Q75.75%         23.220000         1.000000     9.900000   1.7000000
## IQR              3.400000         1.000000     6.100000   0.8000000
## Min             15.030000         0.000000     1.100000   0.1000000
## Max             32.500000        47.000000    25.000000   4.3000000
## CI951           21.416753         1.411871     6.928202   1.1246079
## CI952           22.479191         3.609108     8.322147   1.3551123
##         Data_Lutein_and_Zeaxanthin Data_Lycopene Data_Niacin Data_Protein Data_Retinol
## Count                    100.00000  100.00000000 100.0000000   100.000000   100.000000
## Missing                    0.00000    0.00000000   0.0000000     0.000000     0.000000
## Mean                      23.15000    0.02000000   2.7162600     5.340800    20.130000
## Median                     8.00000    0.00000000   2.2270000     5.005000     0.500000
## SD                        38.92868    0.20000000   2.0749689     2.160389    57.155407
## Q25.25%                    3.00000    0.00000000   1.7500000     3.805000     0.000000
## Q75.75%                   29.00000    0.00000000   3.1382500     6.200000     7.000000
## IQR                       26.00000    0.00000000   1.3882500     2.395000     7.000000
## Min                        0.00000    0.00000000   0.0520000     2.190000     0.000000
## Max                      266.00000    2.00000000  15.9660000    12.500000   270.000000
## CI951                     15.42571   -0.01968434   2.3045412     4.912132     8.789127
## CI952                     30.87429    0.05968434   3.1279788     5.769468    31.470873
## Count                    143.00000  143.00000000 143.0000000   143.000000   143.000000
## Missing                    0.00000    0.00000000   0.0000000     0.000000     0.000000
## Mean                     115.44755   79.46153846   1.5558462     2.892238     4.685315
## Median                    88.00000    0.00000000   1.4250000     2.470000     0.000000
## SD                       134.61597  193.81088391   0.4859281     1.203203    10.615176
## Q25.25%                    0.00000    0.00000000   1.2075000     2.200000     0.000000
## Q75.75%                  165.00000    0.00000000   2.0420000     2.795000     0.000000
## IQR                      165.00000    0.00000000   0.8345000     0.595000     0.000000
## Min                        0.00000    0.00000000   0.2880000     1.160000     0.000000
## Max                      600.00000  849.00000000   2.5480000     7.860000    71.000000
## CI951                     93.19429   47.42280856   1.4755178     2.693337     2.930528
## CI952                    137.70082  111.50026836   1.6361746     3.091138     6.440101
##         Data_Riboflavin Data_Selenium Data_Sugar_Total Data_Thiamin Data_Water
## Count      100.00000000    100.000000      100.0000000 100.00000000 100.000000
## Missing      0.00000000      0.000000        0.0000000   0.00000000   0.000000
## Mean         0.27938000      8.134000       32.7065000   0.26980000   7.885700
## Median       0.22700000      6.300000       32.9000000   0.25700000   5.760000
## SD           0.32909100      4.982540       12.4521820   0.17723938   5.785908
## Q25.25%      0.18725000      4.750000       24.6600000   0.17800000   3.600000
## Q75.75%      0.29400000     10.000000       41.1100000   0.29750000  11.500000
## IQR          0.10675000      5.250000       16.4500000   0.11950000   7.900000
## Min          0.03700000      0.000000        0.0000000   0.00200000   0.700000
## Max          3.22900000     24.700000       80.3500000   1.45900000  24.830000
## CI951        0.21408121      7.145356       30.2357169   0.23463186   6.737650
## CI952        0.34467879      9.122644       35.1772831   0.30496814   9.033750
## Count      143.00000000    143.000000      143.0000000 143.00000000 143.000000
## Missing      0.00000000      0.000000        0.0000000   0.00000000   0.000000
## Mean         0.05167133      5.282517        0.8665035   0.14760140  71.724615
## Median       0.05200000      5.100000        0.7400000   0.14500000  72.590000
## SD           0.02989059      1.738152        1.0041746   0.05496262   4.621275
## Q25.25%      0.02600000      4.450000        0.3800000   0.12000000  69.800000
## Q75.75%      0.06900000      5.700000        0.9850000   0.17300000  74.480000
## IQR          0.04300000      1.250000        0.6050000   0.05300000   4.680000
## Min          0.01300000      0.800000        0.0500000   0.01500000  51.520000
## Max          0.15500000     14.500000        8.7600000   0.30000000  83.140000
## CI951        0.04673014      4.995185        0.7005042   0.13851557  70.960676
## CI952        0.05661252      5.569850        1.0325028   0.15668723  72.488555
##         Data_Fat_Monosaturated_Fat Data_Fat_Polysaturated_Fat Data_Fat_Saturated_Fat
## Count                  100.0000000                100.0000000            100.0000000
## Missing                  0.0000000                  0.0000000              0.0000000
## Mean                     6.0770300                  4.1203400              6.0435000
## Median                   6.0660000                  3.2640000              4.6065000
## SD                       3.2344882                  2.6178138              4.5846143
## Q25.25%                  3.2917500                  2.2590000              3.0465000
## Q75.75%                  8.5010000                  5.7450000              8.0910000
## IQR                      5.2092500                  3.4860000              5.0445000
## Min                      0.0000000                  0.0000000              0.0000000
## Max                     16.0760000                 11.4860000             20.0990000
## CI951                    5.4352374                  3.6009089              5.1338131
## CI952                    6.7188226                  4.6397711              6.9531869
## Count                  143.0000000                143.0000000            143.0000000
## Missing                  0.0000000                  0.0000000              0.0000000
## Mean                     0.8419720                  0.7334685              0.6796084
## Median                   0.9600000                  0.9090000              0.4120000
## SD                       0.5575784                  0.4594583              1.3843598
## Q25.25%                  0.3240000                  0.3040000              0.2305000
## Q75.75%                  1.0600000                  1.0515000              0.4995000
## IQR                      0.7360000                  0.7475000              0.2690000
## Min                      0.0290000                  0.0250000              0.0250000
## Max                      2.6120000                  2.5580000             15.1700000
## CI951                    0.7497992                  0.6575158              0.4507609
## CI952                    0.9341449                  0.8094212              0.9084559
##         Data_Fat_Total_Lipid Data_Major_Minerals_Calcium Data_Major_Minerals_Copper
## Count             100.000000                   100.00000               100.00000000
## Missing             0.000000                     0.00000                 0.00000000
## Mean               17.327200                    33.18000                 0.20293000
## Median             17.955000                    28.00000                 0.18400000
## SD                  7.118397                    35.29025                 0.11470685
## Q25.25%            13.100000                    12.00000                 0.11300000
## Q75.75%            22.550000                    46.00000                 0.26900000
## IQR                 9.450000                    34.00000                 0.15600000
## Min                 0.340000                     0.00000                 0.01900000
## Max                35.300000                   263.00000                 0.58500000
## CI951              15.914756                    26.17765                 0.18016967
## CI952              18.739644                    40.18235                 0.22569033
## Count             143.000000                   143.00000               143.00000000
## Missing             0.000000                     0.00000                 0.00000000
## Mean                2.400140                    19.69231                 0.07880420
## Median              2.420000                    11.00000                 0.07900000
## SD                  1.976264                    27.38464                 0.02583841
## Q25.25%             0.890000                     8.00000                 0.06050000
## Q75.75%             2.710000                    16.50000                 0.09000000
## IQR                 1.820000                     8.50000                 0.02950000
## Min                 0.090000                     2.00000                 0.02800000
## Max                17.230000                   133.00000                 0.25000000
## CI951               2.073445                    15.16537                 0.07453287
## CI952               2.726835                    24.21924                 0.08307552
##         Data_Major_Minerals_Iron Data_Major_Minerals_Magnesium
## Count                100.0000000                     100.00000
## Missing                0.0000000                       0.00000
## Mean                   3.0333000                      30.81000
## Median                 2.5800000                      31.00000
## SD                     1.9070492                      16.97038
## Q25.25%                2.2000000                      15.50000
## Q75.75%                3.2050000                      40.25000
## IQR                    1.0050000                      24.75000
## Min                    0.0000000                       6.00000
## Max                   12.1400000                     101.00000
## CI951                  2.6549001                      27.44271
## CI952                  3.4116999                      34.17729
## Count                143.0000000                     143.00000
## Missing                0.0000000                       0.00000
## Mean                   0.9165035                      21.45455
## Median                 0.8100000                      16.00000
## SD                     0.7734350                      10.55150
## Q25.25%                0.5500000                      12.00000
## Q75.75%                1.0050000                      32.00000
## IQR                    0.4550000                      20.00000
## Min                    0.1400000                       5.00000
## Max                    5.0100000                      39.00000
## CI951                  0.7886475                      19.71028
## CI952                  1.0443595                      23.19881
##         Data_Major_Minerals_Phosphorus Data_Major_Minerals_Potassium
## Count                        100.00000                     100.00000
## Missing                        0.00000                       0.00000
## Mean                          98.48000                     170.69000
## Median                        94.00000                     149.00000
## SD                            47.58734                      90.42332
## Q25.25%                       66.00000                     110.00000
## Q75.75%                      122.25000                     207.00000
## IQR                           56.25000                      97.00000
## Min                            5.00000                      39.00000
## Max                          277.00000                     504.00000
## CI951                         89.03764                     152.74805
## CI952                        107.92236                     188.63195
## Count                        143.00000                     143.00000
## Missing                        0.00000                       0.00000
## Mean                          68.72727                      87.95804
## Median                        74.00000                      87.00000
## SD                            29.21682                      37.08761
## Q25.25%                       41.00000                      69.00000
## Q75.75%                       91.50000                     105.50000
## IQR                           50.50000                      36.50000
## Min                            8.00000                      10.00000
## Max                          139.00000                     219.00000
## CI951                         63.89746                      81.82712
## CI952                         73.55708                      94.08897
##         Data_Major_Minerals_Sodium Data_Major_Minerals_Zinc
## Count                    100.00000              100.0000000
## Missing                    0.00000                0.0000000
## Mean                     336.08000                0.6358000
## Median                   350.00000                0.6300000
## SD                       123.70964                0.2889660
## Q25.25%                  256.75000                0.4500000
## Q75.75%                  403.75000                0.7500000
## IQR                      147.00000                0.3000000
## Min                        9.00000                0.0300000
## Max                      580.00000                1.6000000
## CI951                    311.53332                0.5784629
## CI952                    360.62668                0.6931371
## Count                    143.00000              143.0000000
## Missing                    0.00000                0.0000000
## Mean                     238.11888                0.5713287
## Median                   201.00000                0.5200000
## SD                        91.78952                0.1983603
## Q25.25%                  178.00000                0.4300000
## Q75.75%                  265.00000                0.6900000
## IQR                       87.00000                0.2600000
## Min                       69.00000                0.2200000
## Max                      510.00000                1.3700000
## CI951                    222.94522                0.5385379
## CI952                    253.29254                0.6041195
##         Data_Vitamins_Vitamin_A___RAE Data_Vitamins_Vitamin_B12
## Count                       100.00000              100.00000000
## Missing                       0.00000                0.00000000
## Mean                         21.96000                0.05710000
## Median                        1.00000                0.01500000
## SD                           58.91938                0.10757469
## Q25.25%                       0.00000                0.00000000
## Q75.75%                       8.00000                0.07000000
## IQR                           8.00000                0.07000000
## Min                           0.00000                0.00000000
## Max                         270.00000                0.75000000
## CI951                        10.26912                0.03575485
## CI952                        33.65088                0.07844515
## Count                       143.00000              143.00000000
## Missing                       0.00000                0.00000000
## Mean                         35.91608                0.02090909
## Median                       20.00000                0.00000000
## SD                           46.89432                0.06520724
## Q25.25%                       2.50000                0.00000000
## Q75.75%                      57.50000                0.00000000
## IQR                          55.00000                0.00000000
## Min                           0.00000                0.00000000
## Max                         209.00000                0.52000000
## CI951                        28.16402                0.01012973
## CI952                        43.66815                0.03168845
##         Data_Vitamins_Vitamin_B6 Data_Vitamins_Vitamin_C Data_Vitamins_Vitamin_E
## Count               100.00000000            100.00000000             100.0000000
## Missing               0.00000000              0.00000000               0.0000000
## Mean                  0.16323000              0.34000000               1.3062000
## Median                0.05850000              0.00000000               1.0800000
## SD                    0.60730592              1.24381297               1.0191716
## Q25.25%               0.02600000              0.00000000               0.2600000
## Q75.75%               0.09375000              0.10000000               2.1150000
## IQR                   0.06775000              0.10000000               1.8550000
## Min                   0.00000000              0.00000000               0.0000000
## Max                   5.89900000              9.10000000               4.3200000
## CI951                 0.04272733              0.09320052               1.1039743
## CI952                 0.28373267              0.58679948               1.5084257
## Count               143.00000000            143.00000000             143.0000000
## Missing               0.00000000              0.00000000               0.0000000
## Mean                  0.09911888              2.90139860               0.3113986
## Median                0.10100000              0.80000000               0.3000000
## SD                    0.02691810              4.37064449               0.1600643
## Q25.25%               0.08750000              0.00000000               0.1850000
## Q75.75%               0.12000000              3.60000000               0.4450000
## IQR                   0.03250000              3.60000000               0.2600000
## Min                   0.02600000              0.00000000               0.0200000
## Max                   0.18500000             19.50000000               0.7500000
## CI951                 0.09466907              2.17889068               0.2849385
## CI952                 0.10356869              3.62390652               0.3378587
##         Data_Vitamins_Vitamin_K
## Count                100.000000
## Missing                0.000000
## Mean                   8.414000
## Median                 5.850000
## SD                     8.733044
## Q25.25%                3.800000
## Q75.75%                8.000000
## IQR                    4.200000
## Min                    0.000000
## Max                   34.800000
## CI951                  6.681175
## CI952                 10.146825
## Count                143.000000
## Missing                0.000000
## Mean                   5.448951
## Median                 3.700000
## SD                     5.792842
## Q25.25%                2.300000
## Q75.75%                6.700000
## IQR                    4.400000
## Min                    0.000000
## Max                   28.100000
## CI951                  4.491341
## CI952                  6.406561
```

## Категориальные переменные

1) Рассчитайте для всех категориальных переменных для каждой группы (Category):

1.1) Абсолютное количество;

1.2) Относительное количество внутри группы;

1.3) 95% ДИ для доли внутри группы - задание со звёздочкой.


```r
result_df <- cleaned_data %>%
  group_by(Category) %>%
  summarise(
    Absolute_Count = n(),  # количество ?
    Relative_Count = n() / sum(n()),  # доля внутри группы?
  )

# Print the result
print(result_df)
```

# Визуализация

## Количественные переменные

1) Для каждой количественной переменной сделайте боксплоты по группам. Расположите их либо на отдельных рисунках, либо на одном, но читаемо;

2) Наложите на боксплоты beeplots - задание со звёздочкой.

3) Раскрасьте боксплоты с помощью библиотеки RColorBrewer.


```r
library(ggplot2)
library(ggbeeswarm)
library(RColorBrewer)
library(reshape2)

melted_data <- melt(cleaned_data%>% select(Category, where(is.numeric)), id.vars = "Category")


ggplot(melted_data, aes(x = variable, y = value, fill = Category)) +
  geom_boxplot(outlier.colour = "red", outlier.shape = 1, outlier.size = 2, position = "dodge") +
  geom_beeswarm(data = melted_data, cex = 0.6,  shape = 21,priority='density',size=2.5) +
  scale_fill_brewer(palette = "Set3") +  # Use a color palette from RColorBrewer
  labs(title = "Combined Boxplot with Beeswarm Overlay", x = "Variable", y = "Value") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability
```

![plot of chunk unnamed-chunk-137](figure/unnamed-chunk-137-1.png)

## Категориальные переменные

1) Сделайте подходящие визуализации категориальных переменных. Обоснуйте, почему выбрали именно этот тип.




# Статистические оценки

## Проверка на нормальность

1) Оцените каждую переменную на соответствие нормальному распределению с помощью теста Шапиро-Уилка. Какие из переменных являются нормальными и как как вы это поняли?



2) Постройте для каждой количественной переменной QQ-плот. Отличаются ли выводы от теста Шапиро-Уилка? Какой метод вы бы предпочли и почему?



3) Ниже напишите, какие ещё методы проверки на нормальность вы знаете и какие у них есть ограничения.

**Напишите текст здесь**


## Сравнение групп

1) Сравните группы (переменная **Category**) по каждой переменной (как количественной, так и категориальной). Для каждой переменной выберите нужный критерий и кратко обоснуйте его выбор в комментариях.



# Далее идут **необязательные** дополнительные задания, которые могут принести вам дополнительные баллы в том числе в случае ошибок в предыдущих

## Корреляционный анализ

1) Создайте корреляционную матрицу с визуализацией и поправкой на множественные сравнения. Объясните, когда лучше использовать корреляционные матрицы и в чём минусы и плюсы корреляционных исследований.



## Моделирование

1) Постройте регрессионную модель для переменной **Category**. Опишите процесс построения






